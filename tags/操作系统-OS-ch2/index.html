<!DOCTYPE html>
<html>
<head hexo-theme='https://github.com/volantis-x/hexo-theme-volantis/tree/3.0.0'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
      <meta name="robots" content="noindex,follow">
    
  
  <!-- 渲染优化 -->
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
  <title>Tag: -操作系统 -OS -ch2 - Yokeso</title>
  

  

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="Yokeso">
  

  <!-- import meta -->
  

  <!-- link -->
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13/css/all.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

  

  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">

  

  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
  

  

  <!-- import link -->
  

  
  
    
<link rel="stylesheet" href="/css/style.css">

  

  
  
</head>

<body>
  <header class="l_header shadow blur" style='opacity: 0'>
  <div class='container'>
  <div class='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h m-phone' id="pjax-header-nav-list">
        <li><a class="s-comment fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a class="s-toc fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
            <img no-lazy class='logo' src='https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/blog/Logo-NavBar@3x.png'/>
          
          
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h m-pc'>
          
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/friends/
                  
                  
                  
                    id="friends"
                  >
                  <i class='fas fa-link fa-fw'></i>友链
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search..." />
        </form>
      </div>

			<ul class='switcher nav-list-h m-phone'>
				
					<li><a class="s-search fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/friends/
                  
                  
                  
                    id="friends"
                  >
                  <i class='fas fa-link fa-fw'></i>友链
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>
</header>

  
  
  
  <div class="cover-wrapper">
    <div class='cover ' style="display: none;">
      <div class='cover-bg lazyload placeholder' data-bg=""></div>
      <div class='cover-body'>
  <div class='a'>
    
      <img no-lazy class='logo' src='https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/blog/Logo-Cover@3x.png'/>
    
    
    
  </div>
  <div class='b'>
    <div class='menu navigation dock'>
      <div class='list-h'>
        
          
            <a href="/v3/getting-started/"
              
              
              id="v3getting-started">
              <i class='fas fa-book fa-fw'></i><p>文档</p>
            </a>
          
            <a href="/faqs/"
              
              
              id="faqs">
              <i class='fas fa-question-circle fa-fw'></i><p>帮助</p>
            </a>
          
            <a href="/examples/"
              
              
              id="examples">
              <i class='fas fa-play-circle fa-fw'></i><p>示例</p>
            </a>
          
            <a href="/contributors/"
              
              
              id="contributors">
              <i class='fas fa-fan fa-spin fa-fw'></i><p>社区</p>
            </a>
          
        
      </div>
    </div>
  </div>
</div>

      <div class="scroll-down" style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div>
    </div>
  </div>
  


  <div class="l_body nocover">
    <div class='body-wrapper' id="pjax-container">
      
        <!--此文件用来存放一些不方便取值的变量-->
<!--思路大概是将值藏到重加载的区域内-->



<div id="pjax-data" style="display: none">
  <div id="pjax-ispage">false</div>
  <div id="pjax-pageTitle"></div>
  <div id="pjax-enable-cover">true</div>
  <div id="pjax-comment-path">none</div>
  <div id="pjax-comment-placeholder">none</div>
</div>


<script>
  // 处理封面 此时 jquery 还没加载
  if ("none" == "none") { // 移除封面
    document.getElementsByClassName('cover')[0].style.display = "none"; 
    document.getElementsByClassName('l_body')[0].classList.add("nocover");
    document.getElementsByClassName('l_header', 'cover-wrapper')[0].classList.add("show");
  } else {
    if ("none" == "blog") { // 半屏
      document.getElementsByClassName('cover')[0].classList.remove("full");
      document.getElementsByClassName('cover')[0].classList.add("half");
      document.getElementsByClassName('scroll-down')[0].style.display = "none";
    } else if ("none" == "docs") { // 全屏
      document.getElementsByClassName('cover')[0].classList.remove("half");
      document.getElementsByClassName('cover')[0].classList.add("full");
      document.getElementsByClassName('scroll-down')[0].style.display = "";
    }
    document.getElementsByClassName('cover')[0].style.display = "";
    document.getElementsByClassName('l_body', 'show')[0].classList.remove("nocover");
    document.getElementsByClassName('l_header', 'cover-wrapper')[0].classList.remove("show");
  }
</script>


      
      


<div class='l_main'>
  
    
      
  <section class="post-list ">
    
      
        
          
        
      
    
    
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2020/08/14/OS-ch-2/">
      OS-ch-2
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a class='author' href="/" rel="nofollow">
    <img no-lazy src="">
    <p>请设置文章作者</p>
  </a>
</div>

            
          
            
              

            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：Aug 14, 2020</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  <div class="new-meta-item browse valine">
    <a class='notlink'>
      <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
      
      <span id="/2020/08/14/OS-ch-2/" class="leancloud_visitors" data-flag-title="OS-ch-2">
      <p>
        <span class="leancloud-visitors-count"></span>
      </p>
      </span>
    </a>
  </div>


            
          
            
              
<div class="new-meta-item comments-count">
  
  <a href="/2020/08/14/OS-ch-2/#comments">
    <i class="fas fa-comment-dots fa-fw"></i>
    <span class="valine-comment-count" data-xid="/2020/08/14/OS-ch-2/">0</span>
    <span class="leancloud-comments-count">&nbsp;</span>
  </a>
</div>


            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="第二章-进程管理"><a href="#第二章-进程管理" class="headerlink" title="第二章 进程管理"></a>第二章 进程管理</h2><p>为了描述程序在并发执行时对系统资源的共享，我们需要一个描述程序执行时动态特征的概念，这就是进程或线程。</p>
<h3 id="2-1-进程的基本概念"><a href="#2-1-进程的基本概念" class="headerlink" title="2.1 进程的基本概念"></a>2.1 进程的基本概念</h3><h4 id="2-1-1-程序的基本特征"><a href="#2-1-1-程序的基本特征" class="headerlink" title="2.1.1 程序的基本特征"></a>2.1.1 程序的基本特征</h4><p>程序执行的两种方式：<font color="red">顺序执行</font>和<font color="red">并发执行</font></p>
<p>(1)顺序执行：单道批处理系统的执行方式：<br><strong>特征</strong>：</p>
<ul>
<li><strong>顺序性</strong>：按照程序结构所指定的次序执行。</li>
<li><strong>封闭性</strong>：独占全部资源，计算机的状态只由于该程序的控制逻辑所决定，结果不受外界因素的影响。</li>
<li><strong>可再现性</strong>：初始条件相同则结果相同</li>
</ul>
<p>(2)为了提高资源利用率并发执行</p>
<p>特征：</p>
<ul>
<li>间断性：程序中途停下来失去原有时序的联系。</li>
<li>失去封闭性：共享资源受到其他程序控制影响</li>
<li>失去可再现性：外界环境在程序两次执行期间发生变化</li>
</ul>
<p>并发执行条件：达到封闭性和可再现性。</p>
<h4 id="2-1-2-进程的定义与特征"><a href="#2-1-2-进程的定义与特征" class="headerlink" title="2.1.2 进程的定义与特征"></a>2.1.2 进程的定义与特征</h4><p>进程：一个具有一定独立功能的程序在一个数据集合上一次动态执行的一个过程。</p>
<p>​            处理机、存储器和外设等资源的分配和回收的基本单位</p>
<p>一个进程应该包括：</p>
<ul>
<li>程序代码</li>
<li>程序处理的数据，堆栈</li>
<li>程序计数器中的值，指示下一条将运行的指令</li>
<li>一组通用的寄存器当前值</li>
<li>一组系统资源</li>
</ul>
<p>进程包括了正在运行的一个程序的所有状态信息。</p>
<h5 id="进程与程序的关系"><a href="#进程与程序的关系" class="headerlink" title="进程与程序的关系"></a>进程与程序的关系</h5><ul>
<li><p><strong>程序是产生进程的基础；进程是程序功能的体现。</strong></p>
</li>
<li><p><strong>程序是</strong><font color="red">静态</font>实体；进程是<font color="red">动态</font>过程。</p>
</li>
<li><p><strong>程序是指令、数据及其组织形式的描述；进程是程序（那些指令和数据）的真正运行实例。</strong></p>
</li>
<li><p><strong>进程是暂时的</strong>，是一个状态变化的过程；程序是永久的，可长久保存。</p>
</li>
<li><p><strong>通过多次执行，</strong>一个程序可产生多个进程；<strong>通过调用关系</strong>，一个进程可包括多个程序。</p>
</li>
<li><p><strong>进程需要一些资源才能完成工作，如</strong>CPU使用时间、存储器、文件以及I/O设备。</p>
</li>
</ul>
<h5 id="进程特征："><a href="#进程特征：" class="headerlink" title="进程特征："></a>进程特征：</h5><ul>
<li><p>动态性：创建产生，调度执行，受制于资源，撤销消亡。</p>
</li>
<li><p>进程具有动态的地址空间（数量和内容），地址空间上包括：代码、数据、进程控制块（PCB）</p>
</li>
<li><p>并发性：多个进程同时存在于内存，宏观上同时运行。</p>
</li>
<li><p>独立性：资源分配的单位。</p>
</li>
<li><p>各进程的地址空间相互独立，除非采用进程间通信手段</p>
</li>
<li><p>异步性：进程按各自独立的、不可预知的速度向前推进。</p>
</li>
<li><p>结构化：进程实体由代码段，数据段和进程控制块(PCB) 组成。</p>
<ul>
<li><p>进程控制块包含在核心区。内存核心段通常存放OS核心部分，由各个进程共享，包括各进程的PCB。</p>
</li>
<li><p>程序文件中通常划分为代码段和数据段</p>
</li>
</ul>
</li>
</ul>
<h4 id="2-1-3-进程控制块"><a href="#2-1-3-进程控制块" class="headerlink" title="2.1.3 进程控制块"></a>2.1.3 进程控制块</h4><p>描述进程的数据结构：进程控制块（PCB）</p>
<p>操作系统为每个进程都维护了一个PCB，用来保存与该进程有关的各种状态信息。</p>
<p><img src="/2020/08/14/OS-ch-2/2.1-1.jpg" alt></p>
<h5 id="PCB"><a href="#PCB" class="headerlink" title="PCB:"></a><strong>PCB</strong>:</h5><ul>
<li>OS中最重要的结构类型，记录描述进程执行情况以及控制进程运行的全部信息</li>
<li>进程存在的唯一标志，每个进程在OS中登记的表项，OS通过对PCB的组织管理来对进程进行控制管理。</li>
<li>进程创建时生成PCB，终止时回收PCB</li>
<li>PCB常驻于由OS维护的内存核心区，不能由应用程序自身的代码来直接访问，而要通过系统调用间接访问。</li>
<li>OS专门开辟PCB区将所有的PCB组织成若干个链表或队列。</li>
</ul>
<h5 id="PCB中信息："><a href="#PCB中信息：" class="headerlink" title="PCB中信息："></a><strong>PCB中信息</strong>：</h5><ul>
<li><p>程序描述信息：进程标识符，唯一内部标识符；进程名，外部标识符；本进程的产生者标识(父进程标识)； 用户标识符，以指示拥有该进程的用户。<br>处理机状态信息，保存进程运行现场信息。</p>
</li>
<li><p>通用寄存器  8-32个，用户程序可使用的数据、地址等寄存器</p>
</li>
<li><p>指令计数器  要访问的下一条指令地址</p>
</li>
<li><p>程序状态字PSW  条件码、执行方式、中断屏蔽标志 </p>
</li>
<li><p>用户栈指针  用户进程拥有的系统栈，存放过程和系统调用参数及调用地址</p>
</li>
<li><p>进程调度信息, 用于操作系统调度进程并占用处理机： </p>
<ul>
<li>进程的当前状态； </li>
<li>优先级(priority)； </li>
<li>运行统计信息（执行时间、页面调度）； </li>
<li>事件：阻塞原因等。</li>
</ul>
</li>
<li><p>进程控制信息： </p>
<ul>
<li>程序段和数据段的地址；  </li>
<li>进程间同步和通信； </li>
<li>资源占用信息：除CPU外的进程所需的全部资源及已分配资源清单</li>
<li>链接指针：本进程所在队列的下一个进程的PCB首地址。</li>
</ul>
</li>
</ul>
<h5 id="进程的状态："><a href="#进程的状态：" class="headerlink" title="进程的状态："></a>进程的状态：</h5><p><img src="/2020/08/14/OS-ch-2/2.1-2.jpg" alt></p>
<h5 id="进程调度队列："><a href="#进程调度队列：" class="headerlink" title="进程调度队列："></a>进程调度队列：</h5><ul>
<li><p>由操作系统来维护一组队列，用来表示系统当中所有进程的当前状态。</p>
</li>
<li><p>不同的状态分别用不同的队列来表示（就绪队列，各种类型的堵塞队列）</p>
<ul>
<li>作业队列：系统中所有进程的集合</li>
<li>就绪队列：驻留主存的所有就绪态进程集合</li>
<li>设备队列：等待I/O设备的进程集合</li>
</ul>
</li>
<li><p>队列在各种队列中的迁移：</p>
<ul>
<li>每个进程的PCB都根据它的状态加入到相应的队列当中，当一个进程的状态发生变化时，它的PCB从一个状态队列中脱离出来，加入到另外一个队列。</li>
</ul>
</li>
</ul>
<p><img src="/2020/08/14/OS-ch-2/2.1-3.jpg" alt="就绪队列和各种IO队列"></p>
<h5 id="PCB组织方式（两种）"><a href="#PCB组织方式（两种）" class="headerlink" title="PCB组织方式（两种）"></a>PCB组织方式（两种）</h5><p>链表：同一状态的进程其PCB构成一个链表，多个状态对应多个不同的链表</p>
<p><img src="/2020/08/14/OS-ch-2/2.1-4.jpg" alt="链表方式"></p>
<p>索引表：同一状态的进程归入一个Index表，（由index指向PCB）多个状态对应多个不同的PCB表</p>
<p><img src="/2020/08/14/OS-ch-2/2.1-5.jpg" alt="链表方式"></p>
<h5 id="利用PCB完成进程切换"><a href="#利用PCB完成进程切换" class="headerlink" title="利用PCB完成进程切换"></a>利用PCB完成进程切换</h5><p><img src="/2020/08/14/OS-ch-2/2.1-6.jpg" alt></p>
<h3 id="2-2-进程控制"><a href="#2-2-进程控制" class="headerlink" title="2.2 进程控制"></a>2.2 进程控制</h3><p>进程管理中最基本的功能是<font color="red">进程控制</font></p>
<p>进程的生命周期：</p>
<ul>
<li>进程创建</li>
<li>进程运行</li>
<li>进程等待</li>
<li>进程唤醒</li>
<li>进程终止</li>
</ul>
<p>进程控制任务</p>
<ul>
<li>进程的创建，终止，进程状态的转变等</li>
</ul>
<p>进程控制一般由OS内核的原语来实现</p>
<ul>
<li>原语：由若干指令构成的原子操作</li>
<li>许多系统调用是原语，但不是所有的系统调用都是原语</li>
</ul>
<h4 id="2-2-1-进程的创建"><a href="#2-2-1-进程的创建" class="headerlink" title="2.2.1 进程的创建"></a>2.2.1 进程的创建</h4><h5 id="进程图"><a href="#进程图" class="headerlink" title="进程图"></a>进程图</h5><ul>
<li>树状结构，父子进程关系</li>
<li>子进程可以继承父进程的所有资源，如打开文件，缓冲区等。当子进程被撤销，应将继承的资源还给父进程。撤销父进程也必须同时撤销所有的子进程。</li>
<li>PCB中设置了家族关系表项。</li>
</ul>
<p><img src="/2020/08/14/OS-ch-2/2.2-1.jpg" alt="进程图"></p>
<p>$$<br>引起进程创建的事件\<br>\begin{equation}<br>由操作系统内核创建\begin{cases}<br>1.操作系统初始化\<br>-分时系统中用户登录\<br>-批处理中作业调度\<br>2.提供服务\<br>-用户请求创建进程\<br>\end{cases}<br>\end{equation}<br>$$</p>
<p>$$<br>\begin{equation}<br>由应用程序自身创建\begin{cases}<br>3.应用请求\<br>-正在运行的进程执行了\创建进程的系统调用<br>\end{cases}<br>\end{equation}<br>$$</p>
<p>原语CREAT（）按下述步骤创建一个新进程:</p>
<ul>
<li>申请空白PCB。</li>
<li>为新进程分配资源：为代码、数据、用户栈分配空间。</li>
<li>初始化PCB：初始化标识信息、处理机状态（PC、SP)、处理机控制信息（进程状态、优先级）。 </li>
<li>将新进程插入就绪队列 。 </li>
</ul>
<h4 id="2-2-2-进程的终止"><a href="#2-2-2-进程的终止" class="headerlink" title="2.2.2 进程的终止"></a>2.2.2 进程的终止</h4><p><img src="/2020/08/14/OS-ch-2/2.2-2.jpg" alt></p>
<h5 id="进程的终止过程"><a href="#进程的终止过程" class="headerlink" title="进程的终止过程"></a>进程的终止过程</h5><ul>
<li>从PCB集合中检索出该进程的PCB，从中读出该进程的状态。</li>
<li>若处于执行状态，终止该进程的执行，并置调度标志为真，重新调度。</li>
<li>若有子孙进程，将所有子孙进程终止。</li>
<li>将进程全部资源归还其父进程或系统：释放内外存空间、关闭所有打开文件、释放当前</li>
<li>目录、释放共享内存段和各种锁定lock。</li>
<li>将其PCB从所在队列（或链表）中移出 </li>
</ul>
<h5 id="unix进程终止过程"><a href="#unix进程终止过程" class="headerlink" title="unix进程终止过程"></a>unix进程终止过程</h5><ul>
<li><p>进程执行完最后一条语句，请求操作系统删除进程(通过执行exit系统调用)。</p>
<ul>
<li>将子进程运行数据传递给父进程（通过 wait系统调用)。</li>
<li>回收的系统资源由操作系统再另行分配</li>
</ul>
</li>
<li><p>父进程也可以终止子进程的执行（通过abort系统调用)。原因：</p>
<ul>
<li>子进程超额使用资源.</li>
<li>分配给子进程执行的任务不再需要执行.</li>
<li>父进程退出。<ul>
<li>如果父进程终止，操作系统不再允许子进程继续执行。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2-2-3-进程的阻塞与唤醒"><a href="#2-2-3-进程的阻塞与唤醒" class="headerlink" title="2.2.3 进程的阻塞与唤醒"></a>2.2.3 进程的阻塞与唤醒</h4><p>$$<br>\begin{equation}<br>引起阻塞和唤醒的事件\begin{cases}<br>请求系统服务\<br>启动某种操作\<br>新数据尚未到\<br>无新工作可做<br>\end{cases}<br>\end{equation}<br>$$</p>
<h5 id="进程阻塞过程"><a href="#进程阻塞过程" class="headerlink" title="进程阻塞过程"></a>进程阻塞过程</h5><ul>
<li>正在执行的进程，发生上述事件时，自身调用有关阻塞原语，进入等待队列。进程的主动性行为。</li>
<li>进程由运行态变为阻塞态</li>
<li>引起处理机调度。</li>
</ul>
<p><img src="/2020/08/14/OS-ch-2/2.2-3.jpg" alt></p>
<h5 id="进程唤醒过程"><a href="#进程唤醒过程" class="headerlink" title="进程唤醒过程"></a>进程唤醒过程</h5><ul>
<li>唤醒原因：等待的事件到达。</li>
<li>由阻塞队列转入就绪队列。进程由阻塞态变为就绪态.</li>
<li>方法：其他有关进程（例如用完并释放了该I/O设备的进程）发送信号到某个或一组进程。</li>
</ul>
<p><img src="/2020/08/14/OS-ch-2/2.2-4.jpg" alt></p>
<p><strong>BLOCK和WAKEUP是一队作用相反的原语。</strong><br>如果在某进程中调用了<font color="red">阻塞原语</font>，则必须在与之相合作的另一进程中或其他相关的进程中，安排<font color="red">唤醒原语</font>，以能唤醒阻塞进程；否则，被阻塞进程将会因不能被唤醒而长久地处于阻塞状态，从而再无机会继续运行。</p>
<h4 id="2-2-4-进程的挂起与激活"><a href="#2-2-4-进程的挂起与激活" class="headerlink" title="2.2.4 进程的挂起与激活"></a>2.2.4 进程的挂起与激活</h4><h5 id="挂起引入原因："><a href="#挂起引入原因：" class="headerlink" title="挂起引入原因："></a>挂起引入原因：</h5><ul>
<li><p><font color="red">终端用户请求</font></p>
<ul>
<li>终端用户发现自己运行的程序有问题，希望暂停自己程序的执行</li>
</ul>
</li>
<li><p><font color="red">父进程请求</font></p>
<ul>
<li>父进程希望挂起自己的某个子进程，以便考察和修改该子进程</li>
</ul>
</li>
<li><p><font color="red">负荷调节需要</font></p>
<ul>
<li>高优先级的进程要执行，而内存不空，系统将低优先级进程对换至外存。</li>
<li>提高处理机效率：就绪进程表为空时，要提交新进程，而此时内存不空，需挂起阻塞态的进程</li>
<li>为运行进程提供足够内存（对换及调整负荷）：资源紧张时，暂停某些进程，如：实时任务执行，而内存紧张。</li>
</ul>
</li>
<li><p><font color="red">操作系统的需要</font></p>
<ul>
<li>操作系统需要挂起某些进程以便检查运行中的资源使用情况或进行记账</li>
</ul>
</li>
</ul>
<h5 id="进程的挂起"><a href="#进程的挂起" class="headerlink" title="进程的挂起"></a>进程的挂起</h5><ul>
<li>目的：合理且充分地利用系统资源。进程在挂起状态时，进程没有占用内存空间，仅映像在磁盘上。</li>
<li>执行过程：挂起原语：SUSPEND（）</li>
<li>挂起原语的执行过程：<ul>
<li>从内存调到外存，改变进程的状态。</li>
<li>若处于活动就绪状态，改为静止就绪；</li>
<li>若处于活动阻塞状态，则改为静止阻塞；</li>
<li>若正在执行，则转向调度程序重新调度。</li>
</ul>
</li>
</ul>
<h5 id="进程的激活"><a href="#进程的激活" class="headerlink" title="进程的激活"></a>进程的激活</h5><ul>
<li>原因：父进程或用户进程请求，或内存已有足够空间</li>
<li>执行过程：从外存调入内存，改变进程的状态</li>
<li>可能也会引起处理机调度</li>
</ul>
<h5 id="挂起引起的状态转变"><a href="#挂起引起的状态转变" class="headerlink" title="挂起引起的状态转变"></a>挂起引起的状态转变</h5><p><img src="/2020/08/14/OS-ch-2/2.2-5.jpg" alt></p>
<ul>
<li>引入的新状态<ul>
<li>就绪挂起（静止就绪）：进程在外存，但只要进入内存，即可运行；</li>
<li>阻塞挂起状态（静止阻塞）：进程在外存并等待某事件的出现。</li>
</ul>
</li>
</ul>
<h5 id="有挂起状态的进程状态图"><a href="#有挂起状态的进程状态图" class="headerlink" title="有挂起状态的进程状态图"></a>有挂起状态的进程状态图</h5><p><img src="/2020/08/14/OS-ch-2/2.2-6.jpg" alt></p>
<h5 id="创建和终止状态"><a href="#创建和终止状态" class="headerlink" title="创建和终止状态"></a>创建和终止状态</h5><p><img src="/2020/08/14/OS-ch-2/2.2-7.jpg" alt></p>
<h5 id="制约关系"><a href="#制约关系" class="headerlink" title="制约关系"></a>制约关系</h5><p>由于多进程在系统中的并发执行，进程之间存在2种制约关系：<br><font color="red">间接制约</font>:进程间由于共享某种系统资源，而形成的相互制约。</p>
<p><code>进程A-&gt;资源-&gt;进程B</code></p>
<p><font color="red">直接制约</font>：进程间由于合作而形成的相互制约</p>
<p><code>进程A------&gt;进程B</code></p>
<h5 id="进程的两大关系"><a href="#进程的两大关系" class="headerlink" title="进程的两大关系"></a>进程的两大关系</h5><h6 id="互斥"><a href="#互斥" class="headerlink" title="互斥"></a>互斥</h6><p><strong>由于共享资源所要求的排他性，进程间要相互竞争，以获得这些资源的使用权。</strong></p>
<h6 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h6><p><strong>多个进程中发生的事件存在某种时序关系，必须协同工作、相互配合，以共同完成一项任务。</strong></p>
<h3 id="2-3-进程同步"><a href="#2-3-进程同步" class="headerlink" title="2.3 进程同步"></a>2.3 进程同步</h3><p>进程并发地对共享数据的访问有可能引起数据的不一致性。<br>为了维持数据的一致性，必须有一种机制来保证协作进程之间按某种正确的次序执行。</p>
<h5 id="临界资源"><a href="#临界资源" class="headerlink" title="临界资源"></a>临界资源</h5><ul>
<li>临界资源：硬件或软件（如外设、共享代码段、共享数据结构），多个进程在对其进行访问时（关键是进行写入或修改），必须互斥地进行。</li>
<li>有些共享资源可以同时访问，如只读数据。因而不是临界资源。</li>
</ul>
<h5 id="临界区"><a href="#临界区" class="headerlink" title="临界区"></a>临界区</h5><ul>
<li><p><font color="red">临界区(critical section)</font>：在每个进程中，访问临界资源的一段代码。</p>
<ul>
<li><strong>临界区问题－－确保一个进程在执行它的临界区代码时，不允许其他进程再进入他们各自的临界区内执行代码</strong>。</li>
</ul>
</li>
<li><p><font color="red">进入区(entry section)</font>：在进入临界区之前，检查可否进入临界区的一段代码。如果可以进入临界区，通常设置相应“正在访问临界区”标志</p>
</li>
<li><p><font color="red">退出区(exit section)</font>：位于临界区的后面，用于将“正在访问临界区”标志清除。</p>
</li>
<li><p><font color="red">剩余区(remainder section)</font>：代码中的其余部分。</p>
</li>
</ul>
<h5 id="访问临界区的循环进程描述"><a href="#访问临界区的循环进程描述" class="headerlink" title="访问临界区的循环进程描述"></a>访问临界区的循环进程描述</h5><p><img src="/2020/08/14/OS-ch-2/2.3-1.jpg" alt></p>
<ul>
<li><p>当进程处于临界区时，说明进程正在占用处理机，只要不破坏临界资源的使用规则，是不会影响处理及调度的。比如，通常访问临界资源可能是慢速的外设（如打印机），如果在进程访问打印机是，不能处理机调度，那么系统的性能将非常低。</p>
</li>
<li><p>不适合处理机调度的情况：</p>
<ul>
<li>在处理中断的过程中</li>
<li>进程在操作系统内核程序临界区中</li>
<li>其他需要完全屏蔽中断的原子操作过程中</li>
</ul>
</li>
</ul>
<h5 id="同步机制应遵循的准则："><a href="#同步机制应遵循的准则：" class="headerlink" title="同步机制应遵循的准则："></a>同步机制应遵循的准则：</h5><ul>
<li>空闲则入：其他进程均不处于临界区，应允许请求进入临界区的进程进入；</li>
<li>忙则等待：已有进程处于其临界区，请求进入临界区的进程应等待；</li>
<li>有限等待：等待进入临界区的进程不能“死等”；</li>
<li>让权等待：不能进入临界区的进程，应释放CPU（如转换到阻塞状态）</li>
</ul>
<h5 id="解决临界区问题的算法"><a href="#解决临界区问题的算法" class="headerlink" title="解决临界区问题的算法"></a>解决临界区问题的算法</h5><p><img src="/2020/08/14/OS-ch-2/2.3-2.jpg" alt></p>
<h4 id="2-3-3-信号量机制"><a href="#2-3-3-信号量机制" class="headerlink" title="2.3.3 信号量机制"></a>2.3.3 信号量机制</h4><ul>
<li>信号量是OS提供的管理公有资源的有效手段。</li>
<li>整型信号量或记录型信号量可以代表可用资源实体的数量。</li>
</ul>
<h5 id="1-整型信号量机制"><a href="#1-整型信号量机制" class="headerlink" title="1.整型信号量机制"></a>1.整型信号量机制</h5><ul>
<li>1965年，荷兰学者Dijkstra提出（所以P、V分别是荷兰语的test(proberen)和increment(verhogen)），是一种卓有成效的进程同步机制。</li>
<li>最初Dijkstra把信号量定义为整型量s和两个原子操作（除初始化操作）：P和V, 现又称为：wait和signal。</li>
</ul>
<h5 id="2-记录型信号量机制"><a href="#2-记录型信号量机制" class="headerlink" title="2.记录型信号量机制"></a>2.记录型信号量机制</h5><figure class="highlight cc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> count;	     </span><br><span class="line">        <span class="class"><span class="keyword">struct</span>  <span class="title">process</span> *<span class="title">queue</span>;</span> </span><br><span class="line">        &#125; semaphore;</span><br></pre></td></tr></table></figure>

<p>每个信号量s<br>一个整数值s.count：其初值表示某类资源的数目（又称为“资源信号量”)<br>一个进程等待队列s.queue，是阻塞在该信号量的各个进程的PCB链成的队列。</p>
<p><img src="/2020/08/14/OS-ch-2/2.3-3.jpg" alt></p>
<p>信号量只能通过初始化和两个标准的原语（wait、signal）来访问－－作为OS核心代码执行，不受进程调度的打断。</p>
<p><img src="/2020/08/14/OS-ch-2/2.3-4.jpg" alt></p>
<h5 id="3-AND型信号量"><a href="#3-AND型信号量" class="headerlink" title="3.AND型信号量"></a>3.AND型信号量</h5><p>基本思想：将进程在整个运行中需要的所有资源，一次性全部分配给进程，待进程使用完后一起释放。</p>
<p><img src="/2020/08/14/OS-ch-2/2.3-5.jpg" alt></p>
<h5 id="4-二进制（Binary-）信号量"><a href="#4-二进制（Binary-）信号量" class="headerlink" title="4.二进制（Binary ）信号量"></a>4.二进制（Binary ）信号量</h5><ul>
<li>其值只能是 0和 1；易于实现。</li>
<li>利用二进制信号量可以实现整型信号量。</li>
<li>数据结构：<pre><code>二进制信号量 S1, S2;
  int C:  </code></pre></li>
<li>初值：<pre><code>S1 = 1
  S2 = 0
  C = 代表共享资源的初始值</code></pre></li>
</ul>
<p><img src="/2020/08/14/OS-ch-2/2.3-6.jpg" alt></p>
<h4 id="2-3-4-信号量的应用"><a href="#2-3-4-信号量的应用" class="headerlink" title="2.3.4 信号量的应用"></a>2.3.4 信号量的应用</h4><ol>
<li><h5 id="利用信号量实现互斥"><a href="#利用信号量实现互斥" class="headerlink" title="利用信号量实现互斥"></a>利用信号量实现互斥</h5><ul>
<li>为临界资源设置一个互斥信号量mutex，其初值为1；在每个进程中将临界区代码置于wait(mutex)和signal(mutex)原语之间</li>
</ul>
</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">semaphore mutex = <span class="number">1</span>;   </span><br><span class="line">			 …</span><br><span class="line">           <span class="keyword">do</span>&#123;</span><br><span class="line">             …</span><br><span class="line">               wait ( mutex );</span><br><span class="line">               critical section</span><br><span class="line">              signal( mutex );</span><br><span class="line">              remaider section</span><br><span class="line">           &#125;<span class="keyword">while</span> (<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><h5 id="利用信号量实现同步"><a href="#利用信号量实现同步" class="headerlink" title="利用信号量实现同步"></a>利用信号量实现同步</h5></li>
</ol>
<ul>
<li><p>前趋关系：并发执行的进程P1和P2中，分别有代码C1和C2，要求C1在C2开始前完成；</p>
<ul>
<li><p>为每个前趋关系设置一个互斥信号量S12，其初值为0</p>
</li>
<li><p>P1:                      P2:</p>
<p>C1;                      wait(s12);<br>signal(s12)          C2；</p>
</li>
</ul>
</li>
</ul>
<h3 id="2-4-经典的进程同步问题"><a href="#2-4-经典的进程同步问题" class="headerlink" title="2.4 经典的进程同步问题"></a>2.4 经典的进程同步问题</h3><h4 id="2-4-1-生产者消费者问题"><a href="#2-4-1-生产者消费者问题" class="headerlink" title="2.4.1 生产者消费者问题"></a>2.4.1 生产者消费者问题</h4><h5 id="1-问题描述："><a href="#1-问题描述：" class="headerlink" title="1) 问题描述："></a>1) 问题描述：</h5><p>若干进程通过有限的共享缓冲区交换数据。其中，“生产者”进程不断写入，而“消费者”进程不断读出；共享缓冲区共有N个；任何时刻只能有一个进程可对共享缓冲区进行操作。</p>
<h5 id="2）制约关系："><a href="#2）制约关系：" class="headerlink" title="2）制约关系："></a>2）制约关系：</h5><p>生产者与消费者之间不直接发生联系，他们通过缓冲区发生制约关系<br>生产者生产商品，若缓冲区已满生产者等待，直到缓冲区有空为止<br>消费者在缓冲区空时等待，直到生产者的商品放入。否则，取一个商品消费。<br>注意：缓冲区为循环缓冲区</p>
<h5 id="3）问题分析"><a href="#3）问题分析" class="headerlink" title="3）问题分析"></a>3）问题分析</h5><p>采用信号量机制，定义两个资源信号量<br>full是缓冲池“满”数目，初值为0，empty是缓冲池“空”数目，初值为N。实际上，full和empty是同一个含义：<br>           full + empty == N<br>只要缓冲池未满empty&gt;0，生产者便可将消息送入缓冲池；<br>只要缓冲池未空full&gt;0，消费者便可从缓冲池取走一个消息。 </p>
<h5 id="4）问题解答"><a href="#4）问题解答" class="headerlink" title="4）问题解答"></a>4）问题解答</h5><p><img src="/2020/08/14/OS-ch-2/2.4-1.jpg" alt></p>
<h5 id="5）问题扩充"><a href="#5）问题扩充" class="headerlink" title="5）问题扩充"></a>5）问题扩充</h5><p>若生产者与消费者变成多对多关系，我们要做什么变动？<br>增加互斥信号量: mutex=1;</p>
<p><img src="/2020/08/14/OS-ch-2/2.4-2.jpg" alt></p>
<h5 id="6）注意："><a href="#6）注意：" class="headerlink" title="6）注意："></a>6）注意：</h5><ul>
<li>每个程序中互斥的wait(mutex)和signal(mutex)必须成对出现。</li>
<li>对资源信号量empty和full的wait 、signal操作成对出现，但它们分别处于不同的程序中。例如wait在计算进程中，而signal则在打印进程中，计算进程若因执行wait而阻塞，则以后将由打印进程将它唤醒。</li>
<li>每个程序中的wait操作顺序不能颠倒。应先执行对资源信号量的wait操作，然后再执行对互斥信号量的wait操作，否则可能引起进程死锁。</li>
</ul>
<h4 id="2-4-2-读者写者问题"><a href="#2-4-2-读者写者问题" class="headerlink" title="2.4.2 读者写者问题"></a>2.4.2 读者写者问题</h4><h5 id="1）问题描述"><a href="#1）问题描述" class="headerlink" title="1）问题描述"></a>1）问题描述</h5><ul>
<li>一个数据文件或记录可被多个进程共享。其中，有些进程要求读；而另一些进程要求行写或修改。</li>
<li>只要求读的进程称为“Reader进程”，其它进程称为“Writer进程”。</li>
</ul>
<h5 id="2）制约关系"><a href="#2）制约关系" class="headerlink" title="2）制约关系"></a>2）制约关系</h5><ul>
<li>任一时刻“写者”最多只允许一个，而“读者”则允许多个――“读－写”互斥，“写－写”互斥，“读－读”允许。</li>
<li>所谓读者一写者问题是指保证一个Writer进程必须与其它进程互斥地访问共享对象的同步问题。</li>
</ul>
<h5 id="3）问题分析-1"><a href="#3）问题分析-1" class="headerlink" title="3）问题分析"></a>3）问题分析</h5><ul>
<li><p>读者优先的解决方案：</p>
<ul>
<li>互斥信号量wrt，初值是1，代表一个共享文件。为解决“读－写”互斥，“写－写”互斥。</li>
<li>一个记数器，即整型变量readcount，记录读者数，初值是0。<ul>
<li>来一个读者， readcount加1</li>
<li>当readcount ＝1表示是第一个读者， 则需要执行p操作抢占文件；否则表示已有读者在安全的读数据。</li>
<li>走一个读者，readcount减1</li>
<li>当readcount ＝0表示是最后一个读者，则需要v操作释放资源；否则表示还有读者在读数据。</li>
</ul>
</li>
<li>readcount 为多个读者共享的变量，是临界资源。用互斥信号量mutex控制, mutex初值是1。</li>
</ul>
</li>
<li><p>写者优先：</p>
<ul>
<li>当一个写进程声明想写时，不允许新的读进程访问该数据区。</li>
</ul>
</li>
<li><p>解决方案：</p>
<ul>
<li>增加信号量r，初值是1：当至少有一个写进程准备访问数据区时，用于禁止所有的读进程。</li>
<li>一个记数器，即整型变量writecount，记录写者数，初值是0。</li>
<li>writecount为多个写者共享的变量，是临界资源。用互斥信号量mutex2控制, mutex2初值是1。</li>
<li>增加mutex3，初值是1：在r上不允许建造长队列，否则写进程将不能跳过这个队列，因此，只允许一个读进程在r上排队，而所有其他读进程在等待r之前，在信号量mutex3上排队。</li>
</ul>
</li>
</ul>
<h5 id="4）问题解答-1"><a href="#4）问题解答-1" class="headerlink" title="4）问题解答"></a>4）问题解答</h5><p>读者优先方式：</p>
<p><img src="/2020/08/14/OS-ch-2/2.4-3.jpg" alt></p>
<p>写者优先方式：<br><img src="/2020/08/14/OS-ch-2/2.4-4.jpg" alt></p>
<h4 id="2-4-3-哲学家进餐问题"><a href="#2-4-3-哲学家进餐问题" class="headerlink" title="2.4.3 哲学家进餐问题"></a>2.4.3 哲学家进餐问题</h4><h5 id="1）问题描述-1"><a href="#1）问题描述-1" class="headerlink" title="1）问题描述"></a>1）问题描述</h5><p>（由Dijkstra首先提出并解决）</p>
<ul>
<li>5个哲学家围绕一张圆桌而坐，桌子上放着5支筷子，每两个哲学家之间放一支；</li>
<li>哲学家的动作包括思考和进餐：<ul>
<li>进餐时需要同时拿起他左边和右边的两支筷子，</li>
<li>思考时则同时将两支筷子放回原处。</li>
</ul>
</li>
</ul>
<h5 id="2）问题分析"><a href="#2）问题分析" class="headerlink" title="2）问题分析"></a>2）问题分析</h5><ul>
<li>哲学家逆时针编号0-4，筷子也相应编号</li>
<li>定义互斥信号量数组chopstick[5], 对应5支筷子，初值均为1。</li>
</ul>
<p>死锁问题的解决方法：</p>
<p><img src="/2020/08/14/OS-ch-2/2.4-5.jpg" alt></p>
<p><img src="/2020/08/14/OS-ch-2/2.4-6.jpg" alt></p>
<p><img src="/2020/08/14/OS-ch-2/2.4-7.jpg" alt></p>
<h3 id="2-5-管程"><a href="#2-5-管程" class="headerlink" title="2.5 管程"></a>2.5 管程</h3><h4 id="2-5-1-管程的基本概念"><a href="#2-5-1-管程的基本概念" class="headerlink" title="2.5.1 管程的基本概念"></a>2.5.1 管程的基本概念</h4><ul>
<li>利用信号量实现进程同步，使大量的同步操作分散在各个进程中。使系统管理麻烦，同步操作使用不当会引起死锁。</li>
<li>引入新的进程同步工具－－－管程（Monitors)</li>
<li>目的：分离互斥和条件同步的关注</li>
</ul>
<h5 id="管程由四部分组成："><a href="#管程由四部分组成：" class="headerlink" title="管程由四部分组成："></a>管程由四部分组成：</h5><ul>
<li><p>管程的名称</p>
</li>
<li><p>局部于管程的共享变量说明</p>
</li>
<li><p>对该数据结构进行操作的一组过程</p>
</li>
<li><p>对管程中数据设置初值的语句</p>
</li>
</ul>
<p>任何管程外的过程都不能访问管程内的数据结构。管程相当于围墙，将共享变量和对它进行操作的若干过程围了起来，进程只要访问临界资源就必须通过管程。</p>
<p>管程每次只允许一个进程进入管程，实现了互斥。</p>
<p>使用信号量的效率比管程高。</p>
<p>管程结构在一些程序设计语言中得到实现。如并发Pascal和Java，C#等，它还被作为一个程序库实现。</p>
<h3 id="2-6-进程之间的通信"><a href="#2-6-进程之间的通信" class="headerlink" title="2.6 进程之间的通信"></a>2.6 进程之间的通信</h3><p>进程通信时指进程之间的信息交换，所交换的信息量，少者是一个状态，多者是成千上万字节。</p>
<h4 id="进程通信分类："><a href="#进程通信分类：" class="headerlink" title="进程通信分类："></a>进程通信分类：</h4><h5 id="低级通信："><a href="#低级通信：" class="headerlink" title="低级通信："></a>低级通信：</h5><p>只能传递状态和整数值（控制信息）包括进程互斥和同步所采用的信号量和管程机制。</p>
<h6 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h6><p>传送信息量小，效率低，每次通信传输的信息量固定，传递较多信息需要多次通信。</p>
<p>编程复杂：用户直接实现通信的细节，容易出错。</p>
<h5 id="高级通信"><a href="#高级通信" class="headerlink" title="高级通信"></a>高级通信</h5><p>利用复杂的特定数据结构进行大信息量的通信。通信效率高。包括：</p>
<ul>
<li>共享存储器系统<ul>
<li>互相通信的进程共享某些数据结构或存储区，进程之间通过这些空间进行通信。分两类。<ul>
<li>共享数据结构：如缓冲区<ul>
<li>公用数据结构的设置及进程间同步的处理由程序员负责，OS只提供共享存储器</li>
<li>通信效率低，只适合少量数据</li>
</ul>
</li>
<li>共享存储区：为传递大量数据在存储器中划出一片共享存储区<ul>
<li>进程通信前，先向系统申请获得存储区的一个分区，并指定关键字；若系统已经给其他进程分配分区，则把该分区的描述符返回给申请者，申请者将获得的共享存储区连接到本进程上；此后可像读写普通存储器一样读写公用存储区。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>消息传递系统<ul>
<li>程序员利用OS提供的系统原语进行通信。简化通信程序编制</li>
</ul>
</li>
<li>管道通信系统<ul>
<li>利用读进程写进程实现通信的共享文件–pipe文件</li>
<li>写进程用字符流输入大流量数据送入管道，读进程接收数据</li>
<li>要求：<ul>
<li>互斥</li>
<li>同步</li>
<li>对方存在</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="消息传递实现方式："><a href="#消息传递实现方式：" class="headerlink" title="消息传递实现方式："></a>消息传递实现方式：</h4><h5 id="直接通信："><a href="#直接通信：" class="headerlink" title="直接通信："></a>直接通信：</h5><ul>
<li><p>利用OS提供的发送命令将消息发送到目标进程</p>
</li>
<li><p>发送进程和接收进程都以显示方式提供对方标识符。</p>
</li>
</ul>
<h5 id="间接通信："><a href="#间接通信：" class="headerlink" title="间接通信："></a>间接通信：</h5><p>利用双方之外的共享数据结构作为通信中转。（信箱）</p>
<p>信箱分为3类：</p>
<ul>
<li>私用信箱：用户自己创建，其他用户只能发送信息</li>
<li>公用信箱：OS创建，符合要求的进程都可以发消息</li>
<li>共享信箱：进程创建</li>
</ul>
<h3 id="2-7-线程"><a href="#2-7-线程" class="headerlink" title="2.7 线程"></a>2.7 线程</h3><p>线程：更小的能独立运行的单位。是进程当中执行的一条流程</p>
<p>引入线程是为了提高系统内程序的并发程度，提高系统效率增大作业吞吐量。</p>
<p>提出原因：进程开销过大，建立销毁执行效率不高。</p>
<p>需要满足特性：</p>
<ul>
<li>实体之间可以并发执行</li>
<li>实体之间共享相同的地址空间</li>
</ul>
<h4 id="线程的属性："><a href="#线程的属性：" class="headerlink" title="线程的属性："></a>线程的属性：</h4><ul>
<li><p>共享进程资源：一个进程的所有线程具有相同的地址空间，可以访问进程拥有的资源</p>
</li>
<li><p>轻型实体：</p>
<ul>
<li>只有少数资源<ul>
<li>线程标识符</li>
<li>线程控制块TCB</li>
<li>核心栈</li>
<li>私有存储区</li>
</ul>
</li>
</ul>
</li>
<li><p>线程是处理机调度的单位</p>
</li>
<li><p>可并发执行</p>
</li>
</ul>
<h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ul>
<li>一个进程中可以同时存在多个线程；</li>
<li>各个线程之间可以并发地执行；</li>
<li>线程的创建和终止时间比进程短；</li>
<li>各个线程之间可以共享内存和文件资源，因此可进行直接通信而不需要通过OS的内核。</li>
</ul>
<h4 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>一个线程崩溃，会导致其所属进程的所有线程崩溃</li>
</ul>
<h4 id="进程与线程的比较"><a href="#进程与线程的比较" class="headerlink" title="进程与线程的比较"></a>进程与线程的比较</h4><p><img src="/2020/08/14/OS-ch-2/2.7-1.jpg" alt></p>
<h4 id="OS对线程的支持"><a href="#OS对线程的支持" class="headerlink" title="OS对线程的支持"></a>OS对线程的支持</h4><p>1.用户级线程：</p>
<ul>
<li>仅存在与用户空间中，内核不了解。</li>
<li>用线程库函数来控制</li>
<li>一个线程阻塞，整个进程都要等待</li>
<li>时间片分配给进程，线程执行时间相对较短</li>
</ul>
<p>2.内核线程</p>
<ul>
<li>OS支持，创建撤销切换都由内核实现</li>
<li>创建管理慢于用户级线程</li>
<li>能在多处理机并行，一个线程阻塞整个进程不阻塞</li>
</ul>
<h4 id="多线程模型"><a href="#多线程模型" class="headerlink" title="多线程模型"></a>多线程模型</h4><p>多对一</p>
<ul>
<li>多个用户级对一个内核</li>
<li>线程管理在用户空间进行，效率高</li>
<li>一个线程阻塞，整个进程阻塞</li>
</ul>
<p>一对一</p>
<ul>
<li>每个用户级线程都对应一个内核线程。</li>
<li>如果一个线程执行了阻塞系统调用，能允许另一个线程继续执行</li>
<li>缺点：创建内核线程的开销会影响应用程序的性能，限制系统所支持的线程数量。</li>
</ul>
<p>多对多</p>
<ul>
<li>用户线程数&gt;=内核数，与特定程序机器有关</li>
<li>允许系统根据资源分配创建内核进程。</li>
</ul>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
    
  </section>
  
    
    <!-- 根据主题中的设置决定是否在archive中针对摘要部分的MathJax公式加载mathjax.js文件 -->
    
    

  


    
  
</div>
<aside class='l_side'>
  
  
    
    

<section class="widget blogger shadow desktop mobile">
  <div class='content'>
    
      
        <a class='avatar flat-box rectangle' href='/about/'>
          <img no-lazy src='https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/blog/Logo-NavBar@3x.png'/>
        </a>
      
    
    
      <div class='text'>
        
        
        
          <p><span id="jinrishici-sentence">Yokeso</span></p>
          <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
        
      </div>
    
    
      <div class="social-wrapper">
        
          
            <a href="/atom.xml"
              class="social fas fa-rss flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="mailto:me@xxx.com"
              class="social fas fa-envelope flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://github.com/volantis-x/"
              class="social fab fa-github flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://music.163.com/#/user/home?id=63035382"
              class="social fas fa-headphones-alt flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
      </div>
    
  </div>
</section>

  

  
    
    

  

  
    
    
  

  <section class="widget tagcloud shadow desktop mobile">
    
  <header>
    
      <a href='/blog/tags/'><i class="fas fa-tags fa-fw" aria-hidden="true"></i><span class='name'>热门标签</span></a>
    
  </header>


    <div class='content'>
      <a href="/tags/DSP-2020-lunboli/" style="font-size: 14px; color: #999">-DSP -2020 -lunboli</a> <a href="/tags/Hexo-%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/" style="font-size: 14px; color: #999">-Hexo -个人博客</a> <a href="/tags/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-ch3/" style="font-size: 14px; color: #999">-OS -操作系统 -ch3</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-OS-ch2/" style="font-size: 14px; color: #999">-操作系统 -OS -ch2</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-OS-ch3/" style="font-size: 14px; color: #999">-操作系统 -OS -ch3</a>
    </div>
  </section>


  

  


</aside>


    </div>
    
  
  <footer class="clearfix">
    <br><br>
    
      
        <div class="aplayer-container">
          

  
    <meting-js
      theme='#1BCDFC'
      autoplay='false'
      volume='0.7'
      loop='all'
      order='list'
      fixed='false'
      list-max-height='320px'
      server='netease'
      type='playlist'
      id='3175833810'
      list-folded='true'>
    </meting-js>
  


        </div>
      
    
      
        <br>
        <div class="social-wrapper">
          
            
              <a href="/atom.xml"
                class="social fas fa-rss flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="mailto:me@xxx.com"
                class="social fas fa-envelope flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://github.com/volantis-x/"
                class="social fab fa-github flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://music.163.com/#/user/home?id=63035382"
                class="social fas fa-headphones-alt flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
        </div>
      
    
      
        <div><p>Blog content follows the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0) License</a></p>
</div>
      
    
      
        Use
        <a href="https://github.com/volantis-x/hexo-theme-volantis/tree/3.0.0" target="_blank" class="codename">Volantis</a>
        as theme, total visits
          <span id="busuanzi_value_site_pv"><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span>
          times
        
      
    
      
        <div class='copyright'>
        <p><a href="/">Copyright © 2017-2020 XXX</a></p>

        </div>
      
    
  </footer>


    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  <div>
    
      
  

  <div id="rightmenu-wrapper">
    <ul class="list-v rightmenu" id="rightmenu-content">
      <li class='option'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-text' onclick='document.execCommand("copy")'><i class='fa fa-copy fa-fw'></i>Copy Text</a>
        <hr id='hr-text'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-href'><i class='fa fa-link fa-fw'></i>Copy Link</a>
        <a class='vlts-menu opt fix-cursor-default' id='menu-open-href'><i class='fa fa-external-link-square-alt fa-fw'></i>Open Link in New Tab</a>
        <hr id='hr-href'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-src'><i class='fa fa-image fa-fw'></i>Copy Image Link</a>
        <hr id='hr-src'>
      </li>
      
        <li class='navigation'>
          <a class='nav icon-only fix-cursor-default' onclick='history.back()'><i class='fa fa-arrow-left fa-fw'></i></a>
          <a class='nav icon-only fix-cursor-default' onclick='history.forward()'><i class='fa fa-arrow-right fa-fw'></i></a>
          <a class='nav icon-only fix-cursor-default' onclick='window.location.reload()'><i class='fa fa-redo fa-fw'></i></a>
          <a class='nav icon-only fix-cursor-default' href='/'><i class='fa fa-home fa-fw'></i></a>
        </li>
      
      <hr>
      
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' href=https://volantis.js.org/faqs/
        
        
        
        
          id="https:volantisjsorgfaqs"
        >
        <i class='fa fa-question fa-fw'></i> 常见问题
      </a>
    </li>
  
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' href=https://volantis.js.org/examples/
        
        
        
        
          id="https:volantisjsorgexamples"
        >
        <i class='fa fa-rss fa-fw'></i> 示例博客
      </a>
    </li>
  
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' href=https://volantis.js.org/contributors/
        
        
        
        
          id="https:volantisjsorgcontributors"
        >
        <i class='fa fa-fan fa-spin fa-fw'></i> 加入社区
      </a>
    </li>
  
        
      
        
          <hr>
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' href=https://github.com/volantis-x/volantis-docs/
        
        
        
        
          id="https:githubcomvolantis-xvolantis-docs"
        >
        <i class='fa fa-code-branch fa-fw'></i> 本站源码
      </a>
    </li>
  
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' href=https://github.com/volantis-x/hexo-theme-volantis/
        
        
        
        
          id="https:githubcomvolantis-xhexo-theme-volantis"
        >
        <i class='fa fa-code-branch fa-fw'></i> 主题源码
      </a>
    </li>
  
        
      
        
          <hr>
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' 
        
        
        
          onclick="document.execCommand('print')"
        
        >
        <i class='fa fa-print fa-fw'></i> 打印页面
      </a>
    </li>
  
        
      
        
          <hr>
        
      
        
          <li class='music name'>
            <p class='nav music-title fix-cursor-default'></p>
          </li>
          <li class='music ctrl'>
            <a class='nav icon-only backward fix-cursor-default' onclick='aplayerBackward()'><i class='fa fa-step-backward fa-fw'></i></a>
            <a class='nav icon-only toggle fix-cursor-default' onclick='aplayerToggle()'><i class='fa fa-play fa-fw'></i></a>
            <a class='nav icon-only forward fix-cursor-default' onclick='aplayerForward()'><i class='fa fa-step-forward fa-fw'></i></a>
          </li>
          <li class='music volume'>
            <a class='nav volume'>
              <div class="aplayer-volume-bar-wrap">
                <div class="aplayer-volume-bar fix-cursor-pointer">
                  <div class="aplayer-volume"></div>
                  <i class='left fa fa-volume-off fa-fw'></i>
                  <i class='right fa fa-volume-up fa-fw'></i>
                </div>
              </div>
            </a>
          </li>
        
      
    </ul>
  </div>

  <script>
    window.document.oncontextmenu = function (event) {
      if (event.ctrlKey) return true;
      if (/Android|webOS|BlackBerry/i.test(navigator.userAgent)) return true;
      return popMenu(event);
    };
    document.addEventListener("click", function (event) {
      var mymenu = document.getElementById('rightmenu-wrapper');
      mymenu.style.display = "none";
    });
    function popMenu(event) {
      var mymenu = document.getElementById('rightmenu-wrapper');
      var menuContent = document.getElementById('rightmenu-content');
      var screenWidth = document.documentElement.clientWidth || document.body.clientWidth;
      var screenHeight = document.documentElement.clientHeight || document.body.clientHeight;
      mymenu.style.left = event.clientX + "px"; // 获取鼠标位置
      mymenu.style.top = event.clientY + "px";
      mymenu.style.display = 'block';
      if (event.clientX * 2 > screenWidth) {
        menuContent.classList.add('left');
      } else {
        menuContent.classList.remove('left');
      }
      if (event.clientY * 2 > screenHeight) {
        menuContent.classList.add('top');
      } else {
        menuContent.classList.remove('top');
      }

      let hrText = document.getElementById('hr-text');
      let hrSrc = document.getElementById('hr-src');
      let hrHref = document.getElementById('hr-href');

      // 选中图片
      let copySrc = document.getElementById('menu-copy-src');
      if (copySrc != undefined) {
        if (event.target.currentSrc) {
          copySrc.style.display = 'block';
          copySrc.addEventListener("click", function (e) {
            copyString(event.target.currentSrc);
          },{once: true});
          hrSrc.style.display = 'block';
        } else {
          copySrc.style.display = 'none';
          hrSrc.style.display = 'none';
        }
      }

      // 选中按钮
      // 判断是不是按钮
      let href = '';
      if (event.path) {
        for (i = 0; i < event.path.length; i++) {
          if (event.path[i].href != undefined && event.path[i].href.length > 0) {
            href = event.path[i].href;
          }
        }
      }

      let copyText = document.getElementById('menu-copy-text');
      copyText.style.display = 'none';
      hrText.style.display = 'none';
      if (href.length == 0) {
        // 选中文本
        if (window.getSelection().toString()) {
          copyText.style.display = 'block';
          hrText.style.display = 'block';
        }
      }

      // 在新标签页打开
      let openHref = document.getElementById('menu-open-href');
      if (openHref != undefined) {
        if (href.length > 0) {
          openHref.style.display = 'block';
          openHref.addEventListener("click", function (e) {
            window.open(href);
          },{once: true});
          hrHref.style.display = 'block';
        } else {
          openHref.style.display = 'none';
          hrHref.style.display = 'none';
        }
      }
      // 复制链接
      let copyHref = document.getElementById('menu-copy-href');
      if (copyHref != undefined) {
        if (href.length > 0) {
          copyHref.style.display = 'block';
          copyHref.addEventListener("click", function (e) {
            copyString(href);
          },{once: true});
        } else {
          copyHref.style.display = 'none';
        }
      }

      // 有音乐播放器
      if (true == true) {
        // 如果有aplayer，初始化一下
      	try {
      		checkAPlayer();
          updateTitle();
      	} catch (error) {
      		console.log(error);
      	}
      }

      return false; // 该行代码确保系统自带的右键菜单不会被调出
    }
    function hideMenu() {
      document.getElementById('rightmenu-wrapper').style.display = 'none';
    }
    function copyString(str) {
      const input = document.createElement('input');
      input.setAttribute('readonly', 'readonly');
      document.body.appendChild(input);
      input.setAttribute('value', str);
      input.select();
      document.execCommand('copy');
      document.body.removeChild(input);
    }
    document.execCommand('click');
  </script>


    
    <!-- required -->

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5/dist/jquery.min.js"></script>


<!-- optional -->

  
  
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js"></script>

    <script type="text/javascript">
      $(function(){
        var imgs=["https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/001.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/002.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/003.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/004.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/005.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/006.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/012.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/016.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/019.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/033.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/034.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/035.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/038.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/039.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/042.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/046.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/051.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/052.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/054.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/056.jpg"];
        if ('true' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
        if ('.cover') {
          $('.cover').backstretch(
            imgs,
          {
            duration: "10000",
            fade: "1500"
          });
        } else {
          $.backstretch(
            imgs,
          {
            duration: "10000",
            fade: "1500"
          });
        }
      });
    </script>
  



  <script>
  
  var SEARCH_SERVICE = "hexo" || "hexo";
  var ROOT = "/" || "/";
  if (!ROOT.endsWith('/')) ROOT += '/';
</script>






  <script async src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@2/js/instant_page.js" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>


<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  function pjax_fancybox() {
    $(".article-entry").find("img").not('.inline').not('a img').each(function () { //渲染 fancybox
      var element = document.createElement("a"); // a 标签
      $(element).attr("class", "fancybox");
      $(element).attr("pjax-fancybox", "");  // 过滤 pjax
      $(element).attr("href", $(this).attr("src"));
      if ($(this).attr("data-original")) {
        $(element).attr("href", $(this).attr("data-original"));
      }
      $(element).attr("data-fancybox", "images");
      var caption = "";   // 描述信息
      if ($(this).attr('alt')) {  // 判断当前页面是否存在描述信息
        $(element).attr('data-caption', $(this).attr('alt'));
        caption = $(this).attr('alt');
      }
      var div = document.createElement("div");
      $(div).addClass("fancybox");
      $(this).wrap(div); // 最外层套 div ，其实主要作用还是 class 样式
      var span = document.createElement("span");
      $(span).addClass("image-caption");
      $(span).text(caption); // 加描述
      $(this).after(span);  // 再套一层描述
      $(this).wrap(element);  // 最后套 a 标签
    })
    $(".article-entry").find("img").fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
      closeClick: true,
      helpers: {
        overlay: {closeClick: true}
      },
      buttons: [
        "zoom",
        "close"
      ]
    });
  };
  $(function () {
    pjax_fancybox();
  });
</script>


  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
    var clipboard = new ClipboardJS('.btn-copy', {
        target: function (trigger) {
            return trigger.nextElementSibling
        }
    });
    function wait(callback, seconds) {
        var timelag = null;
        timelag = window.setTimeout(callback, seconds)
    }
    function pjax_initCopyCode() {
        var copyHtml = '';
        copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
        copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
        copyHtml += '</button>';
        $(".highlight .code pre").before(copyHtml);
        $(".article pre code").before(copyHtml);
        clipboard.off('success').on('success', function (e) {
            let $btn = $(e.trigger);
            $btn.addClass('copied');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-check-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPIED';
            wait(function () {
                $icon.removeClass('fa-check-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        });
        clipboard.off('error').on('error', function (e) {
            e.clearSelection();
            let $btn = $(e.trigger);
            $btn.addClass('copy-failed');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-times-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPY FAILED';
            wait(function () {
                $icon.removeClass('fa-times-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        })
    }
    $(function () {
        pjax_initCopyCode()
    });
</script>



   <script src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.6/dist/scrollreveal.min.js"></script>
<script type="text/javascript">
  function pjax_scrollrebeal() {
    ScrollReveal().reveal('.l_main .reveal', {
      distance: '32px',
      duration: '800',
      interval: '20',
      scale: '1',
      easing: 'ease-out'
    });
  }
  $(function () {
    pjax_scrollrebeal();
  });
</script>




  <script>
  let APlayerController = new Object();
  APlayerController.id = '3175833810';  // 设定全局音乐播放ID
  APlayerController.volume = '0.7';
</script>

  
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>


  
<script src="https://cdn.jsdelivr.net/npm/meting@2.0/dist/Meting.min.js"></script>


  
<script src="/js/aplayer.js"></script>






  
  
<script src="/js/valine.js"></script>


<script>
  var GUEST_INFO = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link'.split(',').filter(function (item) {
    return GUEST_INFO.indexOf(item) > -1
  });
  var REQUIRED_FIELDS = ['nick', 'mail', 'link'];
  var requiredFields = 'nick,mail'.split(',').filter(function (item) {
    return REQUIRED_FIELDS.indexOf(item) > -1
  });

  function emoji(path, idx, ext) {
    return path + "/" + path + "-" + idx + "." + ext;
  }

  var emojiMaps = {};
  for (var i = 1; i <= 54; i++) {
    emojiMaps['tieba-' + i] = emoji('tieba', i, 'png');
  }
  for (var i = 1; i <= 101; i++) {
    emojiMaps['qq-' + i] = emoji('qq', i, 'gif');
  }
  for (var i = 1; i <= 116; i++) {
    emojiMaps['aru-' + i] = emoji('aru', i, 'gif');
  }
  for (var i = 1; i <= 125; i++) {
    emojiMaps['twemoji-' + i] = emoji('twemoji', i, 'png');
  }
  for (var i = 1; i <= 4; i++) {
    emojiMaps['weibo-' + i] = emoji('weibo', i, 'png');
  }

  function pjax_valine() {
    let pageUrl = $.trim($('#pjax-comment-path').text()) === "none" ? 
      decodeURI(window.location.pathname) : $.trim($('#pjax-comment-path').text());
    let pagePlaceholder = $.trim($('#pjax-comment-placeholder').text()) === "none" ?
      "快来评论吧~" : $.trim($('#pjax-comment-placeholder').text());

    let ALLPATH = '';
    if(ALLPATH != '') pageUrl = ALLPATH;

    var valine = new Valine();
    valine.init({
      el: '#valine_container',
      meta: meta,
      placeholder: pagePlaceholder,
      path: pageUrl,
      appId: "",
      appKey: "",
      pageSize: '10',
      avatar: 'robohash',
      lang: 'zh-cn',
      visitor: 'true',
      highlight: 'true',
      mathJax: 'false',
      enableQQ: 'true',
      requiredFields: requiredFields,
      emojiCDN: 'https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/valine/',
      emojiMaps: emojiMaps
    })
  }

  $(function () {
    pjax_valine();
  });
</script>






  <script defer src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js" data-pjax></script>


  
<script src="/js/app.js"></script>




  
    
<script src="/js/search.js"></script>

  




  
<script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>

  <script type="text/javascript">
    $(function () {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>







<!-- more -->


    
      


<script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script>

<!-- 样式位于：source/css/_third-party/pjaxanimate.styl -->

<div class="pjax-animate">
  
    <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>
    <div id="loading-bar-wrapper"><script>NProgress.configure({parent:"#loading-bar-wrapper",trickleSpeed: 100})</script></div>
    <script>
      window.ShowLoading = function() {
        NProgress.start();
      };
      window.HideLoading = function() {
        NProgress.done();
      }
    </script>
  
</div>

<script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox])',
        selectors: [
          "title",
          "#pjax-container",
          "#pjax-header-nav-list"
        ],
        cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
        timeout: 5000
      });
    });

    document.addEventListener('pjax:send', function (e) {
      window.stop(); // 相当于点击了浏览器的停止按钮

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      window.subData = null; // 移除标题（用于一二级导航栏切换处）
      $.fancybox.close();    // 关闭弹窗
      $('.l_header .switcher .s-search').removeClass('active'); // 关闭移动端激活的搜索框
      $('.l_header').removeClass('z_search-open'); // 关闭移动端激活的搜索框
      $('.wrapper').removeClass('sub'); // 跳转页面时关闭二级导航

      // 解绑事件 避免重复监听
      $('.s-top').unbind('click');
      $('.menu a').unbind('click');
      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');
      window.ShowLoading();
    });

    document.addEventListener('pjax:complete', function () {
      // 关于百度统计对 SPA 页面的处理：
      // 方案一：百度统计>管理>单页应用设置中，打开开启按钮即可对SPA进行统计。 https://tongji.baidu.com/web/help/article?id=324
      // 方案二：取消注释下列代码。 https://tongji.baidu.com/web/help/article?id=235
      // 

      // 关于谷歌统计对 SPA 页面的处理：
      // 当应用以动态方式加载内容并更新地址栏中的网址时，也应该更新通过 gtag.js 存储的网页网址。
      // https://developers.google.cn/analytics/devguides/collection/gtagjs/single-page-applications?hl=zh-cn
      

      $('.nav-main').find('.list-v').not('.menu-phone').removeAttr("style",""); // 移除小尾巴的移除
      $('.menu-phone.list-v').removeAttr("style",""); // 移除小尾巴的移除
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
      try{
        pjax_fancybox();
        
          
          if ('.cover') {
            $('.cover').backstretch("resize");
          } else {
            $.backstretch("resize");
          }
        
        
        
          pjax_scrollrebeal();
        
        
          pjax_initCopyCode();
        
        
          pjax_valine();
        
        
        
        
        
      } catch (e) {
        console.log(e);
      }
      window.HideLoading();
    });

    document.addEventListener('pjax:error', function (e) {
      window.HideLoading();
      window.location.href = e.triggerElement.href;
    });
</script>

    
  </div>
</body>
</html>
